// Generated by CoffeeScript 1.9.3
(function() {
  var WEB_VIEW_EVENTS, dispatchEvent, ipc, requestId, webFrame,
    slice = [].slice;

  ipc = require('ipc');

  webFrame = require('web-frame');

  requestId = 0;

  WEB_VIEW_EVENTS = {
    'load-commit': ['url', 'isMainFrame'],
    'did-finish-load': [],
    'did-fail-load': ['errorCode', 'errorDescription'],
    'did-frame-finish-load': ['isMainFrame'],
    'did-start-loading': [],
    'did-stop-loading': [],
    'did-get-response-details': ['status', 'newUrl', 'originalUrl', 'httpResponseCode', 'requestMethod', 'referrer', 'headers'],
    'did-get-redirect-request': ['oldUrl', 'newUrl', 'isMainFrame'],
    'dom-ready': [],
    'console-message': ['level', 'message', 'line', 'sourceId'],
    'new-window': ['url', 'frameName', 'disposition'],
    'close': [],
    'crashed': [],
    'gpu-crashed': [],
    'plugin-crashed': ['name', 'version'],
    'destroyed': [],
    'page-title-set': ['title', 'explicitSet'],
    'page-favicon-updated': ['favicons'],
    'enter-html-full-screen': [],
    'leave-html-full-screen': []
  };

  dispatchEvent = function() {
    var args, domEvent, event, f, i, j, len, ref, webView;
    webView = arguments[0], event = arguments[1], args = 3 <= arguments.length ? slice.call(arguments, 2) : [];
    if (WEB_VIEW_EVENTS[event] == null) {
      throw new Error("Unknown event " + event);
    }
    domEvent = new Event(event);
    ref = WEB_VIEW_EVENTS[event];
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      f = ref[i];
      domEvent[f] = args[i];
    }
    webView.dispatchEvent(domEvent);
    if (event === 'load-commit') {
      return webView.onLoadCommit(domEvent);
    }
  };

  module.exports = {
    registerEvents: function(webView, viewInstanceId) {
      ipc.on("ATOM_SHELL_GUEST_VIEW_INTERNAL_DISPATCH_EVENT-" + viewInstanceId, function() {
        var args, event;
        event = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];
        return dispatchEvent.apply(null, [webView, event].concat(slice.call(args)));
      });
      ipc.on("ATOM_SHELL_GUEST_VIEW_INTERNAL_IPC_MESSAGE-" + viewInstanceId, function() {
        var args, channel, domEvent;
        channel = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];
        domEvent = new Event('ipc-message');
        domEvent.channel = channel;
        domEvent.args = slice.call(args);
        return webView.dispatchEvent(domEvent);
      });
      return ipc.on("ATOM_SHELL_GUEST_VIEW_INTERNAL_SIZE_CHANGED-" + viewInstanceId, function() {
        var args, domEvent, f, i, j, len, ref;
        args = 1 <= arguments.length ? slice.call(arguments, 0) : [];
        domEvent = new Event('size-changed');
        ref = ['oldWidth', 'oldHeight', 'newWidth', 'newHeight'];
        for (i = j = 0, len = ref.length; j < len; i = ++j) {
          f = ref[i];
          domEvent[f] = args[i];
        }
        return webView.onSizeChanged(domEvent);
      });
    },
    deregisterEvents: function(viewInstanceId) {
      ipc.removeAllListeners("ATOM_SHELL_GUEST_VIEW_INTERNAL_DISPATCH_EVENT-" + viewInstanceId);
      ipc.removeAllListeners("ATOM_SHELL_GUEST_VIEW_INTERNAL_IPC_MESSAGE-" + viewInstanceId);
      return ipc.removeAllListeners("ATOM_SHELL_GUEST_VIEW_INTERNAL_SIZE_CHANGED-" + viewInstanceId);
    },
    createGuest: function(params, callback) {
      requestId++;
      ipc.send('ATOM_SHELL_GUEST_VIEW_MANAGER_CREATE_GUEST', params, requestId);
      return ipc.once("ATOM_SHELL_RESPONSE_" + requestId, callback);
    },
    attachGuest: function(elementInstanceId, guestInstanceId, params) {
      ipc.send('ATOM_SHELL_GUEST_VIEW_MANAGER_ATTACH_GUEST', elementInstanceId, guestInstanceId, params);
      return webFrame.attachGuest(elementInstanceId);
    },
    destroyGuest: function(guestInstanceId) {
      return ipc.send('ATOM_SHELL_GUEST_VIEW_MANAGER_DESTROY_GUEST', guestInstanceId);
    },
    setSize: function(guestInstanceId, params) {
      return ipc.send('ATOM_SHELL_GUEST_VIEW_MANAGER_SET_SIZE', guestInstanceId, params);
    },
    setAllowTransparency: function(guestInstanceId, allowtransparency) {
      return ipc.send('ATOM_SHELL_GUEST_VIEW_MANAGER_SET_ALLOW_TRANSPARENCY', guestInstanceId, allowtransparency);
    }
  };

}).call(this);
